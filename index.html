<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Valentine</title>

  <style>
    :root{
      --ink:#3b2a33;

      /* GIF positioning */
      --gif-top: 15vh;
      --gif-left: 50vw;
      --gif-size: min(220px, 34vw);
    }

    body{
      margin:0;
      min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--ink);

      /* Desktop BG */
      background: #f6c2d6 url("bg.png") center / cover no-repeat fixed;

      display:grid;
      place-items:center;
      overflow:hidden;
    }

    /* MOBILE BG (upload a 9:16 file as bg_mobile.png) */
    @media (max-width: 768px){
      body{
        background: #f6c2d6 url("bg_mobile.png") center top / cover no-repeat;
        background-attachment: scroll; /* avoids mobile Safari jank */
      }
      .arena{
        transform: translateY(90px);
        width: min(520px, 94vw);
        height: min(240px, 40vh);
      }
      :root{
        --gif-top: 12vh;
        --gif-size: min(240px, 60vw);
      }
    }

    /* GIF overlay that "replaces" the kitten baked into bg.png */
    .gif-overlay{
      position: fixed;
      top: var(--gif-top);
      left: var(--gif-left);
      transform: translate(-50%, 0);
      width: var(--gif-size);
      height: var(--gif-size);
      display:none;
      z-index: 20;
      pointer-events:none;
      filter: drop-shadow(0 18px 24px rgba(59,42,51,0.18));
    }
    .gif-overlay img{
      width:100%;
      height:100%;
      object-fit: contain;
      display:block;
      border-radius: 18px;
    }

    /* Arena = interactive area for buttons */
    .arena{
      width:min(560px, 92vw);
      height:min(260px, 48vh);
      position:relative;

      /* Places buttons roughly inside the empty card area of your bg */
      transform: translateY(120px);
      z-index: 10;
    }

    .btn{
      appearance:none;
      border:0;
      border-radius:18px;
      padding:14px 18px;
      font-weight:800;
      font-size:18px;
      cursor:pointer;
      user-select:none;
      background: rgba(255,255,255,0.85);
      color: #3b2a33;
      border: 1px solid rgba(233,115,150,0.28);
      box-shadow: 0 14px 26px rgba(59,42,51,0.14);
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
      white-space:nowrap;
    }
    .btn:hover{
      transform: translateY(-2px);
      box-shadow: 0 18px 34px rgba(59,42,51,0.18);
      background: rgba(255,255,255,0.92);
    }
    .btn:active{ transform: translateY(0) scale(0.99); }

    #yesBtn{
      position:absolute;
      left: 40px;
      top: 140px;
      min-width: 150px;
      z-index: 11;
    }

    #noBtn{
      position:absolute;
      left: 320px;
      top: 140px;
      min-width: 150px;
      will-change: left, top;
      touch-action:none;
      z-index: 11;

      /* Smooth out the motion (reduces jitter) */
      transition: left 140ms ease-out, top 140ms ease-out;
    }

    /* tiny success popup */
    .toast{
      position:fixed;
      left:50%;
      bottom:28px;
      transform:translateX(-50%);
      padding:14px 18px;
      border-radius:16px;
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(233,115,150,0.25);
      box-shadow: 0 18px 40px rgba(59,42,51,0.16);
      display:none;
      font-weight:800;
      z-index: 30;
    }
    .toast.show{ display:block; }

    /* Optional: when YES clicked, fade buttons out */
    .arena.locked #noBtn,
    .arena.locked #yesBtn{
      opacity: 0.15;
      pointer-events: none;
      transform: none;
    }
  </style>
</head>

<body>
  <!-- Upload yay.gif to repo root -->
  <div class="gif-overlay" id="gifOverlay" aria-hidden="true">
    <img id="yayImg" src="" alt="Yay GIF" />
  </div>

  <div class="arena" id="arena">
    <button class="btn" id="yesBtn">Yes ðŸ’–</button>
    <button class="btn" id="noBtn">No ðŸ˜­</button>
  </div>

  <div class="toast" id="toast">YAYYY ðŸ’–ðŸ’–ðŸ’–</div>

  <script>
    const arena = document.getElementById("arena");
    const noBtn  = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");
    const toast  = document.getElementById("toast");
    const gifOverlay = document.getElementById("gifOverlay");
    const yayImg = document.getElementById("yayImg");

    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    function placeNo(x, y){
      const rect = arena.getBoundingClientRect();
      const bw = noBtn.offsetWidth;
      const bh = noBtn.offsetHeight;
      const pad = 10;

      const minX = pad;
      const maxX = rect.width  - bw - pad;
      const minY = pad;
      const maxY = rect.height - bh - pad;

      noBtn.style.left = `${clamp(x, minX, maxX)}px`;
      noBtn.style.top  = `${clamp(y, minY, maxY)}px`;
    }

    // Start "No" in a valid spot
    function init(){
      const rect = arena.getBoundingClientRect();
      placeNo(Math.min(320, rect.width - noBtn.offsetWidth - 10), 140);
    }
    window.addEventListener("load", init);

    /* -----------------------------
       Smooth "No" movement (less jitter)
    ------------------------------ */
    let rafPending = false;
    let lastPointer = { x: 0, y: 0 };
    let lastFleeAt = 0;

    function fleeFrom(px, py){
      const rect = arena.getBoundingClientRect();
      const bw = noBtn.offsetWidth;
      const bh = noBtn.offsetHeight;
      const pad = 10;

      // Current button center (relative to arena)
      const currentLeft = parseFloat(noBtn.style.left || "0");
      const currentTop  = parseFloat(noBtn.style.top  || "0");
      const bx = currentLeft + bw / 2;
      const by = currentTop  + bh / 2;

      // Vector away from pointer
      let dx = bx - px;
      let dy = by - py;
      const len = Math.hypot(dx, dy) || 1;
      dx /= len; dy /= len;

      // Bigger jump + slight randomness feels smoother/less twitchy
      const jump = 190;
      const jitter = 35;

      const targetX = (bx + dx * jump) - bw/2 + (Math.random()*jitter - jitter/2);
      const targetY = (by + dy * jump) - bh/2 + (Math.random()*jitter - jitter/2);

      // Clamp inside arena
      const minX = pad, maxX = rect.width  - bw - pad;
      const minY = pad, maxY = rect.height - bh - pad;

      noBtn.style.left = `${clamp(targetX, minX, maxX)}px`;
      noBtn.style.top  = `${clamp(targetY, minY, maxY)}px`;
    }

    function processPointer(){
      rafPending = false;
      if (arena.classList.contains("locked")) return;

      const now = Date.now();
      const cooldown = 140; // ms between moves (major jitter fix)
      if (now - lastFleeAt < cooldown) return;

      const bw = noBtn.offsetWidth;
      const bh = noBtn.offsetHeight;

      const currentLeft = parseFloat(noBtn.style.left || "0");
      const currentTop  = parseFloat(noBtn.style.top  || "0");
      const bx = currentLeft + bw/2;
      const by = currentTop  + bh/2;

      const dist = Math.hypot(lastPointer.x - bx, lastPointer.y - by);
      const threshold = 125;

      if (dist < threshold){
        lastFleeAt = now;
        fleeFrom(lastPointer.x, lastPointer.y);
      }
    }

    // One unified event for mouse + touch + pen
    arena.addEventListener("pointermove", (e) => {
      const rect = arena.getBoundingClientRect();
      lastPointer.x = e.clientX - rect.left;
      lastPointer.y = e.clientY - rect.top;

      if (!rafPending){
        rafPending = true;
        requestAnimationFrame(processPointer);
      }
    });

    // Make "No" extra annoying if clicked
    noBtn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      const rect = arena.getBoundingClientRect();
      const rx = Math.random() * (rect.width  - noBtn.offsetWidth  - 20) + 10;
      const ry = Math.random() * (rect.height - noBtn.offsetHeight - 20) + 10;
      placeNo(rx, ry);
    });

    // YES: show toast + overlay GIF covering the baked-in kitten (force restart)
    yesBtn.addEventListener("click", () => {
      toast.classList.add("show");
      gifOverlay.style.display = "block";

      // Force restart + bypass cache
      yayImg.src = "";
      yayImg.src = "yay.gif?v=" + Date.now();

      arena.classList.add("locked");
    });

    // Keep No inside arena on resize
    window.addEventListener("resize", () => {
      placeNo(parseFloat(noBtn.style.left || "0"), parseFloat(noBtn.style.top || "0"));
    });
  </script>
</body>
</html>
